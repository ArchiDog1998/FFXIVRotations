on:
  workflow_dispatch:

jobs:
   build:
    name: build
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v2

      - name: Set up .NET
        uses: actions/setup-dotnet@v1
        with:
          dotnet-version: 7.0.x
             
      - name: Restore Dependencies
        run: dotnet restore
          
      - name: Download Dalamud
        run: |
          Invoke-WebRequest -Uri https://goatcorp.github.io/dalamud-distrib/latest.zip -OutFile latest.zip
          Expand-Archive -Force latest.zip "$env:AppData\XIVLauncher\addon\Hooks\dev"
                      
      - name: Build Plugin
        run: |
          invoke-expression 'dotnet build --no-restore --configuration Release DefaultRotations'
          invoke-expression 'dotnet build --no-restore --configuration Release ExtraRotations'
           
      - name: Upload Artifact
        uses: actions/upload-artifact@v3
        with:
          path: |
            .\DefaultRotations\bin\Release\net7.0-windows\
            .\ExtraRotations\bin\Release\net7.0-windows\

   release:
      name: release
      needs: build
      runs-on: ubuntu-latest

      steps:
        - uses: actions/checkout@v3

        - name: Download Build Artifact
          uses: actions/download-artifact@v3
          
        - name: Display structure of downloaded files
          run: ls -R
